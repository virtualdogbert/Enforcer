<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 8.6.9">
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


/*
 * Theme specific overrides of the preceding (asciidoc.css) CSS.
 *
 */
body {
  font-family: Garamond, Georgia, serif;
  font-size: 17px;
  color: #3E4349;
  line-height: 1.3em;
}
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Garmond, Georgia, serif;
  font-weight: normal;
  border-bottom-width: 0;
  color: #3E4349;
}
div.title, caption.title { color: #596673; font-weight: bold; }
h1 { font-size: 240%; }
h2 { font-size: 180%; }
h3 { font-size: 150%; }
h4 { font-size: 130%; }
h5 { font-size: 115%; }
h6 { font-size: 100%; }
#header h1 { margin-top: 0; }
#toc {
  color: #444444;
  line-height: 1.5;
  padding-top: 1.5em;
}
#toctitle {
  font-size: 20px;
}
#toc a {
    border-bottom: 1px dotted #999999;
    color: #444444 !important;
    text-decoration: none !important;
}
#toc a:hover {
    border-bottom: 1px solid #6D4100;
    color: #6D4100 !important;
    text-decoration: none !important;
}
div.toclevel1 { margin-top: 0.2em; font-size: 16px; }
div.toclevel2 { margin-top: 0.15em; font-size: 14px; }
em, dt, td.hdlist1 { color: black; }
strong { color: #3E4349; }
a { color: #004B6B; text-decoration: none; border-bottom: 1px dotted #004B6B; }
a:visited { color: #615FA0; border-bottom: 1px dotted #615FA0; }
a:hover { color: #6D4100; border-bottom: 1px solid #6D4100; }
div.tableblock > table, table.tableblock { border: 3px solid #E8E8E8; }
th.tableblock, td.tableblock { border: 1px solid #E8E8E8; }
ul > li > * { color: #3E4349; }
pre, tt, .monospaced { font-family: Consolas,Menlo,'Deja Vu Sans Mono','Bitstream Vera Sans Mono',monospace; }
tt, .monospaced { font-size: 0.9em; color: black;
}
div.exampleblock > div.content, div.sidebarblock > div.content, div.listingblock > div.content { border-width: 0 0 0 3px; border-color: #E8E8E8; }
div.verseblock { border-left-width: 0; margin-left: 3em; }
div.quoteblock { border-left-width: 3px; margin-left: 0; margin-right: 0;}
div.admonitionblock td.content { border-left: 3px solid #E8E8E8; }


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>"You&#8217;ve gotta ask yourself one question: <em>Do I feel lucky?</em> Well, do ya, punk?"Dirty Hairy(1971)</p></div>
</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p>The Enforcer Plugin, is a light weight, easier to maintain/extend/use, alternative to Spring Security ACL. The plugin works off of a EnforcerService
and an Enforce Ast transform, The service take s up to 3 closures, a predicate, a failure(defaults to an EnforcerException if not specified) and a
success(defaulted to a closure that returns true). The predicate is evaluated, if it returns true, the the success closure is evaluated, else the
failure closure is evaluated. With this you can enforce any business rule you want. The EnforcerService implements two traits, RoleTrait, and
DomainRoleTrait. This is so you can use the methods in the traits without injecting any extra calls to services, which makes the calls to the
service less verbose, and easier to read. The preferred method of extending the Enforcer Service is to add new methods to the traits, modify the
existing methods in the traits, or add a new trait.</p></div>
<div class="paragraph"><p>The AST Transform Enforce, can be applied to a method, or a class and injects a call to the EnforcerService(usage shown in the usage section). If the AST
transform is applied to the class level it&#8217;s applied to every method in the class, but can be overridden by using it at the method level, The AST transform Enforce,
is more for the aesthetic of making a clear distinction from business rules/security, and your main code, but has the same power as the EnforcerService.
From the AST transform you can call any service, and use any variable pass into the annotated method.</p></div>
<div class="paragraph"><p>The Enforcer plugin was inspired by issues with Spring Security ACL, and trying to figure out a better, and more flexible way of dealing with business rules.</p></div>
<div class="paragraph"><p>Also Zed Shaw&#8217;s:</p></div>
<div class="paragraph"><p><a href="https://vimeo.com/2723800">The ACL is Dead</a></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">Getting Started</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Have the Spring Security Core plug-in installed
</p>
</li>
<li>
<p>
Make sure you&#8217;ve run the quick start(e.g. grails s2-quickstart com.security User Role) note the package name
</p>
</li>
<li>
<p>
Add the Enforcer dependency:
</p>
</li>
</ol></div>
<div class="paragraph"><p>In Grails 2 add the following to your buildConfig.groovy under the plug-ins section:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>compile ":enforcer:1.2.1"</pre>
</div></div>
<div class="paragraph"><p>In grails 3 add the following dependency to your gradle.build:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>compile "org.grails.plugins:enforcer:1.3.1"</pre>
</div></div>
<div class="paragraph"><p>4.Run grails enforcer-quickstart &lt;name of the package you installed spring security core under&gt;</p></div>
<div class="paragraph"><p>5.Check the Usage section and start using Enforcer.</p></div>
<div class="sect2">
<h3 id="_example_applications">Example applications</h3>
<div class="paragraph"><p>For Grails 2:</p></div>
<div class="paragraph"><p><a href="https://github.com/virtualdogbert/testEnforcer2">GitHub testEnforcer2</a></p></div>
<div class="paragraph"><p>For Grails 3:</p></div>
<div class="paragraph"><p><a href="https://github.com/virtualdogbert/testEnforcer3">GitHub testEnforcer3</a></p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>The version scheme is Major.GrailsVersion.Minor</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage">Usage</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here are some code examples of what you can do with the Enforcer plug-in:</p></div>
<div class="paragraph"><p>Check to domain role for the role owner on the Sprocket domain instance for a user</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Checks to see if the test user has the Role ROLE_USER</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>The default closure for success will be called {return true} so the method will be executed</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>The default closure for success will be called {return true} so the method will be executed
in this example you see if your using more than just the predicate closure  you need to specify
the names of the parameters. Also predicate is named value, which facilitates the above example,
so in that case you don&#8217;t have to specify the parameters name, but here you do.</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>The failure closure will get called</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>The success closure will get called</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>The failure closure will get called</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Checking a variable</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>An example using services</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>An example using hasDomainRole and hasRole</p></div>
<div class="listingblock">
<div class="content"></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_why_use_enforcer">Why use Enforcer</h2>
<div class="sectionbody">
<div class="paragraph"><p>So why would you want to use Enforcer? What&#8217;s Wrong with Spring Security ACL?</p></div>
<div class="paragraph"><p>Before I begin I want to say that Spring Security ACL had it&#8217;s time, but I think we can do better, given a dynamic language like Groovy.
I also think that some of the ideas could be portable to a Java 8 lambda syntax. They might not be as convenient, because you don&#8217;t have Groovy&#8217;s truth model,</p></div>
<div class="sect2">
<h3 id="_well_lets_take_a_look_at_the_down_sides_to_using_spring_security_acl">Well lets take a look at the down sides, to using Spring Security ACL</h3>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
It&#8217;s annotations use the Spring EL language, in the form of a string, so&#8230; no compiler help, no IDE help(newer versions of Intellij may help with this), no syntax highlighting, and EL isn&#8217;t as flexible as groovy.
</p>
</li>
<li>
<p>
It uses a "bit mask" for storing permission, while this is very efficient, but hard to read, also we&#8217;re not in the 80&#8217;s anymore, and disk is cheap.
</p>
</li>
<li>
<p>
It uses a highly normalized set for domains/tables for storing permission. This means that querying the db will involve many joins, which will slow down the writing and running of queries.
</p>
</li>
<li>
<p>
Updating permission especially in bulk can be really slow, because of the built-in caching. If you use direct SQL you have to invalidate the plug-ins internal cache.
</p>
</li>
<li>
<p>
The annotation only gets run of you call from a method outside the service, that you are calling to. This can lead to a false sense of security(spring proxy issue).
</p>
</li>
<li>
<p>
If you are not using a hierarchy for your permission, which I don&#8217;t see a config option for, you will end up with a lot of permissions in the db. I&#8217;ve seen it as bad and 400,000 permission entries for just over a 1000 containers.
</p>
</li>
<li>
<p>
Extending the plug-in is not straight forward. Adding new permissions isn&#8217;t bad but you have to deal with the "bit mask". However if you want to add functions that can be called in the EL expression&#8230; good luck.  Adding new functions that you can call would involve some been overrides,  and extending classes. I&#8217;ve tried it twice and it didn&#8217;t work either time.  I do thing however you maybe able to call services from within the EL, with the current version, but don&#8217;t quote me on that.
</p>
</li>
<li>
<p>
It&#8217;s somewhat hard to setup tests your annotations.
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_now_in_response_to_each_enforcer">Now in response to each, Enforcer:</h3>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Use a closure, so you have the full flexibility of groovy, your IDE, will help you and will do syntax highlighting.
</p>
</li>
<li>
<p>
The default DomainRole, which you don&#8217;t have to use uses a string which is easy to read and query.
</p>
</li>
<li>
<p>
The DomainRole is denormalize, so that it will be quicker and involve less queries to read and write.
</p>
</li>
<li>
<p>
As said before DomainRole is denormalized so it&#8217;s quick to update.
</p>
</li>
<li>
<p>
The Enforce AST transform/annotation runs every time a method it&#8217;s annotation is called, unless your are running from the test environment.
</p>
</li>
<li>
<p>
DomainRole uses a hierarchy by default so you&#8217;ll have less entries in the db, which will be easier to query, and migrate if you have too. That 400,000 for 1000 contains was reduced to 20,000 entries using a hierarchy.
</p>
</li>
<li>
<p>
Extending Enforcer is easy, by adding methods to either of the traits the EnforcerService uses, or adding your own trait, to just calling any service from with in the closure(s) you pass in.
</p>
</li>
<li>
<p>
Testing is easy see the EnforcerServiceSpec for examples.
</p>
</li>
</ol></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extending_enforcer">Extending Enforcer</h2>
<div class="sectionbody">
<div class="paragraph"><p>After you run the Enforcer quick start script, in your services you will have the EnforcerService, the RoleTrait and the DomainRole Trait.
You can add function to either of the traits, or add your own traits.  The traits should just be seen as a suggested starting point. You could add
whatever you want like project, group, or feature flag checks.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_testing">Testing</h2>
<div class="sectionbody">
<div class="paragraph"><p>The quick start will install a unit test EnforcerServiceSpec.groovy, which will allow you to test the Enforcer service and the Enforce AST transform.
By default the test for a DomainRole is commented out, you will have to comment it back in and replace the Sprocket domain, with one from your own application.
You will also have to add that domain class to the mock section. Here are some example implementations of the enforcer unit test.</p></div>
<div class="paragraph"><p><a href="https://github.com/virtualdogbert/testEnforcer2/blob/master/test/unit/services/com/security/EnforcerServiceSpec.groovy">Enforcer Unit Tests, in example app(grails2)</a></p></div>
<div class="paragraph"><p><a href="https://github.com/virtualdogbert/testEnforcer3/blob/master/src/test/groovy/unit/services/com/security/EnforcerServiceSpec.groovy">Enforcer Unit Tests, in example app(grails3)</a></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_the_enforcer_ast">The Enforcer AST</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Enforcer AST transform Enforce allows you to put enforcer checks on methods, and classes, making then distinguishable from the main logic as security checks.</p></div>
<div class="sect2">
<h3 id="_how_the_enforce_ast_transform_was_built">How the Enforce AST Transform was built</h3>
<div class="paragraph"><p>The Enforce Transform was built in the testAst project:</p></div>
<div class="paragraph"><p><a href="https://github.com/virtualdogbert/testAst">Enforcer testAST github</a></p></div>
<div class="paragraph"><p>Using the ./scripts/_Events.groovy eventCompileStart hook to precompile the Enforce transform. If you import this project into Intellij You will be
able to set break points in the AST transform, and Intellij will pick them up, which make debugging AST transforms a lot easier.  I also used the
Groovy/Grails Console, and the Inspect AST mode to see, what statements and expressions make up the code I wanted to write.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Last updated
 2016-08-06 14:55:17 EDT
</div>
</div>
</body>
</html>
